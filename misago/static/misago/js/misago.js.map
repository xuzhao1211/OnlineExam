{"version":3,"sources":["misago.js"],"names":["window","Misago","ns","Object","getPrototypeOf","this","self","context","SETTINGS","_services","addService","name","factory","order","push","item","after","get","before","_initServices","services","orderedServices","OrderedList","forEach","undefined","serviceInstance","_destroyServices","reverse","destroy","registerCoreServices","Conf","ComponentFactory","RouterFactory","ajax","api","Outlet","PageTitle","startRouting","setup","init","fixture","inTest","Ajax","_","cookieRegex","RegExp","CSRF_COOKIE_NAME","csrfToken","document","cookie","match","split","runningGets","method","url","data","progress","promise","m","deferred","ajax_settings","headers","X-CSRFToken","dataType","success","pop","resolve","error","jqXHR","rejection","responseJSON","status","statusText","reject","$","preloaded","post","prototype","Api","buildUrl","model","call","querystrings","router","baseUrl","one","id","many","filters","target","component","argumentsArray","i","arguments","length","apply","settings","mount","getElementById","ForumLayout","noop","route","isActive","__controller","controller","__onunload","onunload","vm","__init","initArgs","then","ondata","finalArgs","f","container","errorPage","loading","Loader","__view","view","isReady","Router","attr","staticUrl","mediaUrl","urls","reverses","routedComponent","populatePatterns","urlconf","patterns","finalPattern","pattern","replace","mode","delegateElement","delegateName","cleanUrl","isRelative","substr","location","protocol","host","avatarsUrl","delegateClicks","element","on","e","href","preventDefault","off","prefixUrl","prefix","error403","ban","ErrorBannedRoute","Error403Route","error404","Error404Route","error500","Error500Route","_setTitle","title","completeTitle","page","interpolate","gettext","parent","forum_name","setTitle","ctrl","IndexRoute","forum_index_title","count","prop","increment","console","log","onclick","legalPageFactory","typeName","defaultTitle","dashedTypeName","startComputation","body","endComputation","PageHeader","trust","TermsOfServiceRoute","PrivacyPolicyRoute","legalLink","legalType","FooterNav","isVisible","forum_footnote","terms_of_service","terms_of_service_link","privacy_policy","privacy_policy_link","indexOf","items","ForumFooter","nav","FooterMisagoBranding","BrandFull","branding","children","src","alt","ForumNavbar","desktopNavbar","forum_branding_display","forum_branding_text","config","persistent","el","isInit","retain","LoadingPage","setupMarkup","MisagoMarkup","content","options","has","obj","key","hasOwnProperty","value","returnValue","isOrdered","_items","add","values","values_only","_order","unordered","insertItem","insertAt","ordering","ordered","splice","index","iterations","startsWith","string","beginning","endsWith","tail","UrlConfInvalidComponentError","message","toString","UrlConf","_patterns","prefixPattern","include","loadingPage"],"mappings":"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","file":"misago.js","sourcesContent":["/* global -Misago */\n/* exported Misago */\n(function () {\n  'use strict';\n\n  window.Misago = function() {\n\n    var ns = Object.getPrototypeOf(this);\n    var self = this;\n\n    // Context data\n    this.context = {\n      // Empty settings\n      SETTINGS: {}\n    };\n\n    // Services\n    this._services = [];\n    this.addService = function(name, factory, order) {\n      this._services.push({\n        name: name,\n        item: factory,\n        after: this.get(order, 'after'),\n        before: this.get(order, 'before')\n      });\n    };\n\n    this._initServices = function(services) {\n      var orderedServices = new ns.OrderedList(services).order(false);\n      orderedServices.forEach(function (item) {\n        var factory = null;\n        if (item.item.factory !== undefined) {\n          factory = item.item.factory;\n        } else {\n          factory = item.item;\n        }\n\n        var serviceInstance = factory(self);\n        if (serviceInstance) {\n          self[item.name] = serviceInstance;\n        }\n      });\n    };\n\n    this._destroyServices = function(services) {\n      var orderedServices = new ns.OrderedList(services).order();\n      orderedServices.reverse();\n      orderedServices.forEach(function (item) {\n        if (item.destroy !== undefined) {\n          item.destroy(self);\n        }\n      });\n    };\n\n    this.registerCoreServices = function() {\n      this.addService('conf', ns.Conf);\n      this.addService('component', ns.ComponentFactory);\n      this.addService('router', ns.RouterFactory);\n      this.addService('ajax', ns.ajax);\n      this.addService('api', ns.api);\n      this.addService('outlet', ns.Outlet);\n      this.addService('title', ns.PageTitle);\n      this.addService('start-routing', ns.startRouting);\n    };\n\n    // App init/destory\n    this.setup = false;\n    this.init = function(setup) {\n      this.setup = {\n        fixture: ns.get(setup, 'fixture', null),\n        inTest: ns.get(setup, 'inTest', false)\n      };\n\n      this._initServices(this._services);\n    };\n\n    this.destroy = function() {\n      this._destroyServices();\n    };\n  };\n}());\n\n(function (Misago) {\n  'use strict';\n\n  var Ajax = function(_) {\n    var cookieRegex = new RegExp(_.context.CSRF_COOKIE_NAME + '\\=([^;]*)');\n    this.csrfToken = Misago.get(document.cookie.match(cookieRegex), 0).split('=')[1];\n\n    // list of gets underway\n    var runningGets = {};\n\n    this.ajax = function(method, url, data, progress) {\n      var promise = m.deferred();\n\n      var ajax_settings = {\n        url: url,\n        method: method,\n        headers: {\n          'X-CSRFToken': this.csrfToken\n        },\n\n        data: data | {},\n        dataType: 'json',\n\n        success: function(data) {\n          if (method === 'GET') {\n            Misago.pop(runningGets, url);\n          }\n          promise.resolve(data);\n        },\n        error: function(jqXHR) {\n          if (method === 'GET') {\n            Misago.pop(runningGets, url);\n          }\n\n          var rejection = jqXHR.responseJSON || {};\n\n          rejection.status = jqXHR.status;\n          rejection.statusText = jqXHR.statusText;\n\n          promise.reject(rejection);\n        }\n      };\n\n      if (progress) {\n        return; // not implemented... yet!\n      }\n\n      $.ajax(ajax_settings);\n      return promise.promise;\n    };\n\n    this.get = function(url) {\n      var preloaded = Misago.pop(_.context, url);\n      if (preloaded) {\n        var deferred = m.deferred();\n        deferred.resolve(preloaded);\n        return deferred.promise;\n      } else if (runningGets[url] !== undefined) {\n        return runningGets[url];\n      } else {\n        runningGets[url] = this.ajax('GET', url);\n        return runningGets[url];\n      }\n    };\n\n    this.post = function(url) {\n      return this.ajax('POST', url);\n    };\n  };\n\n  Misago.ajax = function(_) {\n    return new Ajax(_);\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Api = function(_) {\n    this.buildUrl = function(model, call, querystrings) {\n      var url = _.router.baseUrl;\n      url += 'api/' + model + '/';\n      return url;\n    };\n\n    this.one = function(model, id) {\n      var url = this.buildUrl(model) + id + '/';\n      return _.ajax.get(url);\n    };\n\n    this.many = function(model, filters) {\n\n    };\n\n    this.call = function(model, target, call, data) {\n\n    };\n  };\n\n  Misago.api = function(_) {\n    return new Api(_);\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.ComponentFactory = function(_) {\n    // Component factory\n    _.component = function() {\n      var argumentsArray = [];\n      for (var i = 0; i < arguments.length; i += 1) {\n        argumentsArray.push(arguments[i]);\n      }\n\n      argumentsArray.push(_);\n      return m.component.apply(undefined, argumentsArray);\n    };\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.Conf = function(_) {\n    _.settings = Misago.get(_.context, 'SETTINGS', {});\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.Outlet = {\n    factory: function(_) {\n      if (_.setup.fixture) {\n        m.mount(document.getElementById(_.setup.fixture),\n                _.component(Misago.ForumLayout));\n      }\n    },\n\n    destroy: function(_) {\n      if (_.setup.fixture) {\n        m.mount(_.setup.fixture, null);\n      }\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var noop = function() {};\n\n  Misago.route = function(component) {\n    /*\n      Boilerplate for Misago top-level components\n    */\n\n    // Component state\n    component.isActive = true;\n\n    // Wrap controller to store lifecycle methods\n    var __controller = component.controller || noop;\n    component.controller = function() {\n      component.isActive = true;\n\n      var controller = __controller.apply(component, arguments) || {};\n\n      // wrap onunload for lifestate\n      var __onunload = controller.onunload || noop;\n      controller.onunload = function() {\n        __onunload.apply(component, arguments);\n        component.isActive = false;\n      };\n\n      return controller;\n    };\n\n    // Add state callbacks to View-Model\n    if (component.vm && component.vm.init) {\n      // wrap vm.init in promise handler\n      var __init = component.vm.init;\n      component.vm.init = function() {\n        var initArgs = arguments;\n        var promise = __init.apply(component.vm, initArgs);\n\n        if (promise) {\n          promise.then(function() {\n            if (component.isActive && component.vm.ondata) {\n              var finalArgs = [];\n              for (var i = 0; i < arguments.length; i++) {\n                finalArgs.push(arguments[i]);\n              }\n              for (var f = 0; f < initArgs.length; f++) {\n                finalArgs.push(initArgs[f]);\n              }\n\n              component.vm.ondata.apply(component.vm, finalArgs);\n            }\n          }, function(error) {\n            if (component.isActive) {\n              component.container.router.errorPage(error);\n            }\n          });\n        }\n      };\n\n      // setup default loading view\n      if (!component.loading) {\n        component.loading = function () {\n          var _ = this.container;\n          return m('.page.page-loading',\n            _.component(Misago.Loader)\n          );\n        };\n      }\n\n      var __view = component.view;\n      component.view = function() {\n        if (component.vm.isReady) {\n          return __view.apply(component, arguments);\n        } else {\n          return component.loading.apply(component, arguments);\n        }\n      };\n    }\n\n    return component;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Router = function(_) {\n    var self = this;\n    this.baseUrl = $('base').attr('href');\n\n    var staticUrl = Misago.get(_.context, 'STATIC_URL', '/');\n    var mediaUrl = Misago.get(_.context, 'MEDIA_URL', '/');\n\n    // Routing\n    this.urls = {};\n    this.reverses = {};\n\n    var routedComponent = function(component) {\n      component.container = _;\n      return component;\n    };\n\n    var populatePatterns = function(urlconf) {\n      urlconf.patterns().forEach(function(url) {\n        // set service container on component\n\n        var finalPattern = self.baseUrl + url.pattern;\n        finalPattern = finalPattern.replace('//', '/');\n\n        self.urls[finalPattern] = routedComponent(url.component);\n        self.reverses[url.name] = finalPattern;\n      });\n    };\n\n    this.startRouting = function(urlconf, fixture) {\n      populatePatterns(urlconf);\n      this.fixture = fixture;\n\n      m.route.mode = 'pathname';\n      m.route(fixture, '/', this.urls);\n    };\n\n    this.url = function(name) {\n      return this.reverses[name];\n    };\n\n    // Delegate clicks\n    this.delegateElement = null;\n    this.delegateName = 'click.misago-router';\n\n    this.cleanUrl = function(url) {\n      if (!url) { return; }\n\n      // Is link relative?\n      var isRelative = url.substr(0, 1) === '/' && url.substr(0, 2) !== '//';\n\n      // If link contains host, validate to see if its outgoing\n      if (!isRelative) {\n        var location = window.location;\n\n        // If protocol matches current one, strip it from string\n        // otherwhise stop handler\n        if (url.substr(0, 2) !== '//') {\n          var protocol = url.substr(0, location.protocol.length + 2);\n          if (protocol !== location.protocol + '//') { return; }\n          url = url.substr(location.protocol.length + 2);\n        } else {\n          url = url.substr(2);\n        }\n\n        // Host checks out?\n        if (url.substr(0, location.host.length) !== location.host) { return; }\n        url = url.substr(location.host.length);\n      }\n\n      // Is link within Ember app?\n      if (url.substr(0, this.baseUrl.length) !== this.baseUrl) { return; }\n\n      // Is link to media/static/avatar server?\n      if (url.substr(0, staticUrl.length) === staticUrl) { return; }\n\n      if (url.substr(0, mediaUrl.length) === mediaUrl) { return; }\n\n      var avatarsUrl = '/user-avatar/';\n      if (url.substr(0, avatarsUrl.length) === avatarsUrl) { return; }\n\n      return url;\n    };\n\n    this.delegateClicks = function(element) {\n      this.delegateElement = element;\n      $(this.delegateElement).on(this.delegateName, 'a', function(e) {\n        var cleanUrl = self.cleanUrl(e.target.href);\n        if (cleanUrl) {\n          if (cleanUrl != m.route()) {\n            m.route(cleanUrl);\n          }\n          e.preventDefault();\n        }\n      });\n    };\n\n    this.destroy = function() {\n      $(this.delegateElement).off(this.delegateName);\n    };\n\n    // Media/Static url\n    var prefixUrl = function(prefix) {\n      return function(url) {\n        return prefix + url;\n      };\n    };\n\n    this.staticUrl = prefixUrl(staticUrl);\n    this.mediaUrl = prefixUrl(mediaUrl);\n\n    // Errors\n    this.error403 = function(error) {\n      var component = null;\n      if (error.ban) {\n        component = routedComponent(Misago.ErrorBannedRoute);\n      } else {\n        component = routedComponent(Misago.Error403Route);\n      }\n\n      component.vm = error;\n      m.mount(this.fixture, component);\n    };\n\n    this.error404 = function() {\n      m.mount(this.fixture, routedComponent(Misago.Error404Route));\n    };\n\n    this.error500 = function() {\n      m.mount(this.fixture, routedComponent(Misago.Error500Route));\n    };\n\n    this.errorPage = function(error) {\n      if (error.status === 500) {\n        this.error500();\n      }\n\n      if (error.status === 404) {\n        this.error404();\n      }\n\n      if (error.status === 403) {\n        this.error403(error);\n      }\n    };\n  };\n\n  Misago.RouterFactory = function(_) {\n    return new Router(_);\n  };\n\n  Misago.startRouting = function(_) {\n    _.router.startRouting(Misago.urls, document.getElementById('router-fixture'));\n    _.router.delegateClicks(document.getElementById(_.setup.fixture));\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.PageTitle = function(_) {\n    _._setTitle = function(title) {\n      if (typeof title === 'string') {\n        title = {title: title};\n      }\n\n      var completeTitle = title.title;\n\n      if (typeof title.page !== 'undefined' && title.page > 1) {\n        completeTitle += ' (' + interpolate(gettext('page %(page)s'), { page:title.page }, true) + ')';\n      }\n\n      if (typeof title.parent !== 'undefined') {\n        completeTitle += ' | ' + title.parent;\n      }\n\n      document.title = completeTitle + ' | ' + this.settings.forum_name;\n    };\n\n    _.setTitle = function(title) {\n      if (title) {\n        this._setTitle(title);\n      } else {\n        document.title = this.settings.forum_name;\n      }\n    };\n  };\n}(Misago.prototype));\n\n\n(function (Misago) {\n  'use strict';\n\n  Misago.Error403Route = Misago.route({\n    controller: function() {\n      this.container.setTitle(gettext('Page not available'));\n    },\n    error: null,\n    view: function(ctrl) {\n      return m('.container', [\n        m('h1', 'Error 403!'),\n        m('p.lead', this.error || 'No perm to see this page')\n      ]);\n    }\n  });\n\n  Misago.Error404Route = Misago.route({\n    controller: function() {\n      this.container.setTitle(gettext('Page not found'));\n    },\n    view: function(ctrl) {\n      return m('.container', [\n        m('h1', 'Error 404!'),\n        m('p.lead', 'Requested page could not be found.')\n      ]);\n    }\n  });\n\n  Misago.Error500Route = Misago.route({\n    controller: function() {\n      this.container.setTitle(gettext('Application error occured'));\n    },\n    view: function(ctrl) {\n      return m('.container', [\n        m('h1', 'Error 500!'),\n        m('p.lead', 'Application has derped.')\n      ]);\n    }\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.IndexRoute = Misago.route({\n    controller: function() {\n      var _ = this.container;\n      document.title = _.settings.forum_index_title || _.settings.forum_name;\n\n      var count = m.prop(0);\n\n      return {\n        count: count,\n        increment: function() {\n          console.log('increment()');\n          count(count() + 1);\n        }\n      };\n    },\n    view: function(ctrl) {\n      return m('.container', [\n        m('h1', ['Count: ', m('strong', ctrl.count())]),\n        m('p', 'Clicky click button to increase count!.'),\n        m('p',\n          m('button.btn.btn-primary', {onclick: ctrl.increment}, 'Clicky clicky!')\n        )\n      ]);\n    }\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var legalPageFactory = function(typeName, defaultTitle) {\n    var dashedTypeName = typeName.replace(/_/g, '-');\n\n    return Misago.route({\n      controller: function() {\n        var _ = this.container;\n\n        if (Misago.get(_.settings, typeName + '_link')) {\n          window.location = Misago.get(_.settings, typeName + '_link');\n        } else {\n          this.vm.init(this, _);\n        }\n      },\n      vm: {\n        isReady: false,\n        init: function(component, _) {\n          if (this.isReady) {\n            _.setTitle(this.title);\n          } else {\n            _.setTitle();\n            return _.api.one('legal-pages', dashedTypeName);\n          }\n        },\n        ondata: function(data, component, _) {\n          m.startComputation();\n\n          this.title = data.title || defaultTitle;\n          this.body = data.body;\n          this.isReady = true;\n\n          m.endComputation();\n\n          if (component.isActive) {\n            _.setTitle(data.title);\n          }\n        }\n      },\n      view: function() {\n        var _ = this.container;\n\n        return m('.page.page-legal.page-legal-' + dashedTypeName, [\n          _.component(Misago.PageHeader, {title: this.vm.title}),\n          m('.container',\n            m.trust(this.vm.body)\n          )\n        ]);\n      }\n    });\n  };\n\n  Misago.TermsOfServiceRoute = legalPageFactory(\n    'terms_of_service', gettext('Terms of service'));\n  Misago.PrivacyPolicyRoute = legalPageFactory(\n    'privacy_policy', gettext('Privacy policy'));\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var legalLink = function(_, legalType, defaultTitle) {\n    var url = Misago.get(_.settings, legalType + '_link');\n    if (!url && Misago.get(_.settings, legalType)) {\n      url = _.router.url(legalType);\n    }\n\n    if (url) {\n      return m('li',\n        m('a', {href: url}, Misago.get(_.settings, legalType + '_title', defaultTitle))\n      );\n    } else {\n      return null;\n    }\n  };\n\n  Misago.FooterNav = {\n    isVisible: function(settings) {\n      return [\n        !!settings.forum_footnote,\n        !!settings.terms_of_service,\n        !!settings.terms_of_service_link,\n        !!settings.privacy_policy,\n        !!settings.privacy_policy_link\n      ].indexOf(true) !== -1;\n    },\n    view: function(ctrl, _) {\n      var items = [];\n\n      if (_.settings.forum_footnote) {\n        items.push(m('li.forum-footnote', m.trust(_.settings.forum_footnote)));\n      }\n\n      items.push(legalLink(_, 'terms_of_service', gettext('Terms of service')));\n      items.push(legalLink(_, 'privacy_policy', gettext('Privacy policy')));\n\n      return m('ul.list-inline.footer-nav', items);\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.ForumFooter = {\n    view: function(ctrl, _) {\n      var nav = null;\n      if (Misago.FooterNav.isVisible(_.settings)) {\n        nav = _.component(Misago.FooterNav);\n      }\n\n      return m('footer.forum-footer', [\n        m('.container',\n          m('.footer-content', [\n            nav,\n            _.component(Misago.FooterMisagoBranding)\n          ])\n        )\n      ]);\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.FooterMisagoBranding = {\n    view: function() {\n      return m('a.misago-branding[href=http://misago-project.org]', [\n        \"powered by \", m('strong', \"misago\")\n      ]);\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.BrandFull = {\n    view: function(ctrl, branding, _) {\n      var children = [\n        m('img', {\n          src: _.router.staticUrl('misago/img/site-logo.png'),\n          alt: _.settings.forum_name\n        })\n      ];\n\n      if (branding) {\n        children.push(branding);\n      }\n\n      return m('a.navbar-brand', {href: _.router.url('index')}, children);\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.ForumNavbar = {\n    view: function(ctrl, _) {\n      var desktopNavbar = [];\n\n      if (_.settings.forum_branding_display) {\n        desktopNavbar.push(_.component(Misago.BrandFull, _.settings.forum_branding_text));\n      }\n\n      desktopNavbar.push(m('ul.nav.navbar-nav', [\n        m('li', m(\"a\", {config: m.route, href: _.router.url('index')}, 'Index')),\n        m('li', m(\"a\", {config: m.route, href: _.router.url('test')}, 'Test'))\n      ]));\n\n      return m('nav.navbar.navbar-default.navbar-static-top[role=\"navigation\"]', [\n        m('.container.navbar-full.hidden-xs.hidden-sm', desktopNavbar)\n      ]);\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  Misago.ForumLayout = {\n    view: function(ctrl, _) {\n      return [\n        _.component(Misago.ForumNavbar),\n        m('#router-fixture', {config: persistent}),\n        _.component(Misago.ForumFooter)\n      ];\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.Loader = {\n    view: function() {\n      return m('.loader.sk-folding-cube', [\n        m('.sk-cube1.sk-cube'),\n        m('.sk-cube2.sk-cube'),\n        m('.sk-cube4.sk-cube'),\n        m('.sk-cube3.sk-cube')\n      ]);\n    }\n  };\n\n  Misago.LoadingPage = {\n    view: function(ctrl, _) {\n      return m('.page.page-loading',\n        _.component(Misago.Loader)\n      );\n    }\n  };\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var setupMarkup = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  Misago.MisagoMarkup = {\n    view: function(ctrl, content) {\n      return m('article.misago-markup', {config: setupMarkup}, m.trust(content));\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.PageHeader = {\n    view: function(ctrl, options) {\n      return m('.page-header',\n        m('.container', [\n          m('h1', options.title),\n        ])\n      );\n    }\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.has = function(obj, key) {\n    if (obj !== undefined) {\n      return obj.hasOwnProperty(key);\n    } else {\n      return false;\n    }\n  };\n\n  Misago.get = function(obj, key, value) {\n    if (Misago.has(obj, key)) {\n      return obj[key];\n    } else if (value !== undefined) {\n      return value;\n    } else {\n      return undefined;\n    }\n  };\n\n  Misago.pop = function(obj, key, value) {\n    var returnValue = Misago.get(obj, key, value);\n    if (Misago.has(obj, key)) {\n      delete obj[key];\n    }\n    return returnValue;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.OrderedList = function(items) {\n    this.isOrdered = false;\n    this._items = items || [];\n\n    this.add = function(key, item, order) {\n      this._items.push({\n        key: key,\n        item: item,\n        after: Misago.get(order, 'after'),\n        before: Misago.get(order, 'before')\n      });\n    };\n\n    this.get = function(key, value) {\n      for (var i = 0; i < this._items.length; i++) {\n        if (this._items[i].key === key) {\n          return this._items[i].item;\n        }\n      }\n\n      return value;\n    };\n\n    this.has = function(key) {\n      return this.get(key) !== undefined;\n    };\n\n    this.values = function() {\n      var values = [];\n      for (var i = 0; i < this._items.length; i++) {\n        values.push(this._items[i].item);\n      }\n      return values;\n    };\n\n    this.order = function(values_only) {\n      if (!this.isOrdered) {\n        this._items = this._order(this._items);\n        this.isOrdered = true;\n      }\n\n      if (values_only || typeof values_only === 'undefined') {\n        return this.values();\n      } else {\n        return this._items;\n      }\n    };\n\n    this._order = function(unordered) {\n      // Index of unordered items\n      var index = [];\n      unordered.forEach(function (item) {\n        index.push(item.key);\n      });\n\n      // Ordered items\n      var ordered = [];\n      var ordering = [];\n\n      // First pass: register items that\n      // don't specify their order\n      unordered.forEach(function (item) {\n        if (!item.after && !item.before) {\n          ordered.push(item);\n          ordering.push(item.key);\n        }\n      });\n\n      // Second pass: keep iterating items\n      // until we hit iterations limit or finish\n      // ordering list\n      function insertItem(item) {\n        var insertAt = -1;\n        if (ordering.indexOf(item.key) === -1) {\n          if (item.after) {\n            insertAt = ordering.indexOf(item.after);\n            if (insertAt !== -1) {\n              insertAt += 1;\n            }\n          } else if (item.before) {\n            insertAt = ordering.indexOf(item.before);\n          }\n\n          if (insertAt !== -1) {\n            ordered.splice(insertAt, 0, item);\n            ordering.splice(insertAt, 0, item.key);\n          }\n        }\n      }\n\n      var iterations = 200;\n      while (iterations > 0 && index.length !== ordering.length) {\n        iterations -= 1;\n        unordered.forEach(insertItem);\n      }\n\n      return ordered;\n    };\n  };\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.startsWith = function(string, beginning) {\n    return string.indexOf(beginning) === 0;\n  };\n\n  Misago.endsWith = function(string, tail) {\n    return string.indexOf(tail, string.length - tail.length) !== -1;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.UrlConfInvalidComponentError = function(name) {\n    this.message = \"route's \" + name + \" component should be an array or object\";\n\n    this.toString = function() {\n      return this.message;\n    };\n  };\n\n  Misago.UrlConf = function() {\n    var self = this;\n    this._patterns = [];\n\n    this.patterns = function() {\n      return this._patterns;\n    };\n\n    var prefixPattern = function(prefix, pattern) {\n      return (prefix + pattern).replace('//', '/');\n    };\n\n    var include = function(prefix, patterns) {\n      for (var i = 0; i < patterns.length; i ++) {\n        self.url(prefixPattern(prefix, patterns[i].pattern),\n                 patterns[i].component,\n                 patterns[i].name);\n      }\n    };\n\n    this.url = function(pattern, component, name) {\n      if (typeof component !== 'object') {\n        throw new Misago.UrlConfInvalidComponentError(name);\n      }\n\n      if (pattern === '') {\n        pattern = '/';\n      }\n\n      if (component instanceof Misago.UrlConf) {\n        include(pattern, component.patterns());\n      } else {\n        this._patterns.push({\n          pattern: pattern,\n          component: component,\n          name: name\n        });\n      }\n    };\n  };\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.loadingPage = function(_) {\n    return m('.page.page-loading', _.component(Misago.Loader));\n  };\n} (Misago.prototype));\n\n(function (Misago, UrlConf) {\n  'use strict';\n\n  var urls = new UrlConf();\n  urls.url('/', Misago.IndexRoute, 'index');\n\n  // Legal pages\n  urls.url('/terms-of-service/', Misago.TermsOfServiceRoute, 'terms_of_service');\n  urls.url('/privacy-policy/', Misago.PrivacyPolicyRoute, 'privacy_policy');\n\n  Misago.urls = urls;\n} (Misago.prototype, Misago.prototype.UrlConf));\n"],"sourceRoot":"/source/"}